{% extends "base.html" %}
{% load static %}

{% block stats %}{% endblock  %}

{% block content %}
<div class="historico-section">
    <h2>Histórico de Movimentações</h2>
    
    <!-- Formulário de Filtros -->
    <form method="get" class="filtros-form">
        <div class="form-group">
            <label for="data_inicio">Data Inicial:</label>
            <input type="date" id="data_inicio" name="data_inicio" value="{{ filtros.data_inicio }}">
        </div>
        
        <div class="form-group">
            <label for="data_fim">Data Final:</label>
            <input type="date" id="data_fim" name="data_fim" value="{{ filtros.data_fim }}">
        </div>
        
        <div class="form-group">
            <label for="produto_id">Produto:</label>
            <select id="produto_id" name="produto_id">
                <option value="">Todos os produtos</option>
                {% for produto in produtos %}
                <option value="{{ produto.id }}" {% if produto.id|stringformat:"i" == filtros.produto_id %}selected{% endif %}>
                    {{ produto.nome }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="tipo">Tipo de Movimentação:</label>
            <select id="tipo" name="tipo">
                <option value="">Todos os tipos</option>
                <option value="entrada" {% if filtros.tipo == 'entrada' %}selected{% endif %}>Entrada</option>
                <option value="saida" {% if filtros.tipo == 'saida' %}selected{% endif %}>Saída</option>
            </select>
        </div>
        
        <button type="submit" class="btn-buscar">Buscar</button>
        <a href="{% url 'produtos:historico' %}" class="btn-limpar">Limpar Filtros</a>
    </form>

    <!-- Tabela de Resultados -->
    <div class="tabela-movimentacoes">
        <table>
            <thead>
                <tr>
                    <th>Data/Hora</th>
                    <th>Produto</th>
                    <th>Tipo</th>
                    <th>Quantidade</th>
                    <th>Observação</th>
                </tr>
            </thead>
            <tbody>
                {% for mov in movimentacoes %}
                <tr class="{% if mov.tipo == 'saida' %}saida{% else %}entrada{% endif %}">
                    <td>{{ mov.data_hora|date:"d/m/Y H:i" }}</td>
                    <td>{{ mov.produto.nome }}</td>
                    <td>{{ mov.get_tipo_display }}</td>
                    <td>{{ mov.quantidade }}</td>
                    <td>{{ mov.observacao|default:"-" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="sem-resultados">Nenhuma movimentação encontrada</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>



<!-- Estilos específicos para o histórico -->
<style>
.historico-section {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.filtros-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
    padding: 15px;
    background: #f5f5f5;
    border-radius: 5px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    margin-bottom: 5px;
    font-weight: bold;
}

.form-group input,
.form-group select {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.btn-buscar,
.btn-limpar {
    padding: 8px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    text-decoration: none;
    text-align: center;
    margin-top: 22px;
}

.btn-buscar {
    background-color: #4CAF50;
    color: white;
}

.btn-limpar {
    background-color: #f44336;
    color: white;
    display: inline-block;
}

.tabela-movimentacoes {
    overflow-x: auto;
}

.tabela-movimentacoes table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

.tabela-movimentacoes th,
.tabela-movimentacoes td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.tabela-movimentacoes th {
    background-color: #f8f9fa;
    font-weight: bold;
}

.tabela-movimentacoes tr.entrada {
    background-color: #e8f5e9;
}

.tabela-movimentacoes tr.saida {
    background-color: #ffebee;
}

.tabela-movimentacoes tr:hover {
    background-color: #f5f5f5;
}

.sem-resultados {
    text-align: center;
    color: #666;
    padding: 20px;
}

.nav-bar{
  z-index: 1000;
  position: sticky;
  top: 0;
  background-color: #2c3e50;
  width:100%;
  height: 2em;

}
ul.navegation-menu{
  list-style-type: none;
  margin: 0;
  padding: 0;
  overflow: hidden;
  background-color: #2c3e50;
  display: flex;
  justify-content: space-evenly;
}
a.nav-link{
  color: white;
  text-decoration: none;
  font-size: larger;
  font-weight: bold;
}
a.nav-link:hover{
  text-decoration: none;
  color: grey;
}
</style>
{% endblock %}

{% block table-storage %}{% endblock  %}